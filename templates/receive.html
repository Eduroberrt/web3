{% extends 'base_dashboard.html' %}

{% block title %}Receive Funds - Web3 Ledger Pro{% endblock %}

{% block content %}
<div class="min-h-screen bg-darkmode py-12 px-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-white">Receive Funds</h1>
            <p class="text-muted mt-2">Generate deposit address to receive cryptocurrency</p>
        </div>

        <!-- Two Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left Column - Receive Form -->
            <div class="bg-section bg-opacity-10 border border-section border-opacity-20 rounded-lg p-8">
                <h2 class="text-xl font-semibold text-white mb-6">Receive Transaction</h2>
                
                <form method="POST" id="receiveForm">
                    {% csrf_token %}
                    <!-- Select Coin -->
                    <div class="mb-6">
                        <label class="block text-white font-medium mb-3">Select Coin</label>
                        <select name="coin" class="w-full bg-darkmode border border-section border-opacity-30 focus:border-primary rounded-lg px-4 py-3 text-white focus:outline-none transition-colors" required>
                            <option value="" style="background-color: white; color: black;">Select cryptocurrency...</option>
                            <option value="bitcoin" style="background-color: white; color: black;">Bitcoin (BTC)</option>
                            <option value="xrp" style="background-color: white; color: black;">Ripple (XRP)</option>
                            <option value="ethereum" style="background-color: white; color: black;">Ethereum (ETH)</option>
                            <option value="solana" style="background-color: white; color: black;">Solana (SOL)</option>
                            <option value="usdt" style="background-color: white; color: black;">Tether (USDT)</option>
                            <option value="xlm" style="background-color: white; color: black;">Stellar Lumen (XLM)</option>
                            <option value="shiba" style="background-color: white; color: black;">Shiba Inu (SHIB)</option>
                            <option value="usdc" style="background-color: white; color: black;">USD Coin (USDC)</option>
                            <option value="doge" style="background-color: white; color: black;">Dogecoin (DOGE)</option>
                            <option value="ada" style="background-color: white; color: black;">Cardano (ADA)</option>
                            <option value="dot" style="background-color: white; color: black;">Polkadot (DOT)</option>
                            <option value="trx" style="background-color: white; color: black;">Tron (TRX)</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="flex gap-4">
                        <a href="/dashboard/" class="flex-1 bg-section bg-opacity-20 text-white font-medium py-3 rounded-lg hover:bg-opacity-30 transition-colors text-center">
                            Cancel
                        </a>
                        <button type="submit" class="flex-1 text-white font-medium py-3 rounded-lg hover:bg-opacity-90 transition-colors" style="background-color: #F65B1A;">
                            Proceed
                        </button>
                    </div>
                </form>
            </div>

            <!-- Right Column - Transaction History -->
            <div class="bg-section bg-opacity-10 border border-section border-opacity-20 rounded-lg p-8">
                <h2 class="text-xl font-semibold text-white mb-6">Transaction History</h2>
                
                <!-- Search Bar -->
                <div class="mb-6">
                    <input type="text" id="searchTransaction" class="w-full bg-darkmode border border-section border-opacity-30 focus:border-primary rounded-lg px-4 py-3 text-white focus:outline-none transition-colors" placeholder="Search transactions...">
                </div>

                <!-- Transaction Table -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-section border-opacity-20">
                                <th class="text-left text-white font-semibold pb-3 px-2">Date</th>
                                <th class="text-left text-white font-semibold pb-3 px-2">Coin</th>
                                <th class="text-left text-white font-semibold pb-3 px-2">Amount</th>
                                <th class="text-left text-white font-semibold pb-3 px-2">Status</th>
                            </tr>
                        </thead>
                        <tbody id="transactionTableBody">
                            {% if transactions %}
                                {% for transaction in transactions %}
                                <tr class="border-b border-section border-opacity-10">
                                    <td class="py-3 px-2 text-muted text-sm">{{ transaction.created_at|date:"M d, Y" }}</td>
                                    <td class="py-3 px-2 text-white text-sm">{{ transaction.get_coin_type_display }}</td>
                                    <td class="py-3 px-2 text-white text-sm">{{ transaction.amount|default:"-" }}</td>
                                    <td class="py-3 px-2">
                                        {% if transaction.status == 'pending' %}
                                            <span class="text-yellow-500 text-sm">Pending</span>
                                        {% elif transaction.status == 'confirmed' %}
                                            <span class="text-green-500 text-sm">Confirmed</span>
                                        {% else %}
                                            <span class="text-red-500 text-sm">Rejected</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center text-muted py-8">
                                    No data available in table
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('receiveForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    
    fetch('/receive/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': formData.get('csrfmiddlewaretoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Redirect to detail page
            window.location.href = `/receive/${data.coin}/`;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        window.location.href = `/receive/${formData.get('coin')}/`;
    });
});
</script>
{% endblock %}
